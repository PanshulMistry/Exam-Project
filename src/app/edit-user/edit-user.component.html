<div class="edit-user-container">
  <div class="container py-4">
    <!-- Header with back button -->
    <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center mb-4">
      <h2 class="mb-3 mb-md-0">Edit User</h2>
    </div>

    <!-- Main form card -->
    <div class="card shadow-sm">
      <div class="card-body p-3 p-md-4">
        <!-- Loading spinner -->
        <div *ngIf="loading" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Loading user data...</p>
        </div>

        <!-- Error message -->
        <div *ngIf="!loading && errorMessage" class="alert alert-danger">
          {{ errorMessage }}
        </div>

        <!-- Main form -->
        <form *ngIf="!loading && !errorMessage" [formGroup]="userForm" (ngSubmit)="onSubmit()">
          <div class="row">
            <!-- Profile Image Section -->
            <div class="col-12 col-md-4 mb-4 mb-md-0">
              <div class="text-center">
                <div class="profile-image-container mb-4 position-relative d-flex justify-content-center">
                  <div class="rounded-circle overflow-hidden" style="width: 100%; max-width: 200px; height: 200px; background-color: #dee2e6; display: flex; align-items: center; justify-content: center;">
                    <ng-container *ngIf="imagePreview; else initialsBlock">
                      <img [src]="imagePreview" alt="Profile Image" class="img-fluid w-100 h-100" style="object-fit: cover;">
                    </ng-container>
                    <ng-template #initialsBlock>
                      <div class="fw-bold text-uppercase text-primary fs-3">
                        {{ getInitials(userForm.get('name')?.value || '') }}
                      </div>
                    </ng-template>
                  </div>
                </div>

                <!-- Upload Buttons -->
                <div class="image-upload-controls d-flex flex-wrap justify-content-center gap-2">
                  <label for="profileImage" class="btn btn-outline-primary">
                    <i class="bi bi-upload me-2"></i>Choose Image
                  </label>
                  <input type="file" id="profileImage" class="d-none" accept="image/*" (change)="onImageSelected($event)">
                  <button *ngIf="imagePreview" type="button" class="btn btn-outline-danger btn-sm" (click)="removeImage()">
                    <i class="bi bi-trash me-1"></i>Remove
                  </button>
                </div>

                <small class="text-muted d-block mt-2">Recommended: Square image, max 2MB</small>
              </div>
            </div>

            <!-- User Details Section -->
            <div class="col-12 col-md-8">
              <div class="row g-3">
                <!-- Full Name -->
                <div class="col-12 col-md-6">
                  <label for="name" class="form-label">Full Name</label>
                  <input type="text" id="name" formControlName="name" class="form-control" [ngClass]="{'is-invalid': submitted && f['name'].errors}">
                  <div *ngIf="submitted && f['name'].errors" class="invalid-feedback">
                    <div *ngIf="f['name'].errors['required']">Name is required</div>
                  </div>
                </div>

                <!-- Username -->
                <div class="col-12 col-md-6">
                  <label for="username" class="form-label">Username</label>
                  <input type="text" id="username" formControlName="username" class="form-control" [ngClass]="{'is-invalid': submitted && f['username'].errors}">
                  <div *ngIf="submitted && f['username'].errors" class="invalid-feedback">
                    <div *ngIf="f['username'].errors['required']">Username is required</div>
                  </div>
                </div>

                <!-- Email -->
                <div class="col-12 col-md-6">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" id="email" formControlName="email" class="form-control" [ngClass]="{'is-invalid': submitted && f['email'].errors}">
                  <div *ngIf="submitted && f['email'].errors" class="invalid-feedback">
                    <div *ngIf="f['email'].errors['required']">Email is required</div>
                    <div *ngIf="f['email'].errors['email']">Email must be valid</div>
                  </div>
                </div>

                <!-- Contact Number -->
                <div class="col-12 col-md-6">
                  <label for="contactNumber" class="form-label">Contact Number</label>
                  <input type="text" id="contactNumber" formControlName="contactNumber" class="form-control" [ngClass]="{'is-invalid': submitted && f['contactNumber'].errors}">
                  <div *ngIf="submitted && f['contactNumber'].errors" class="invalid-feedback">
                    <div *ngIf="f['contactNumber'].errors['required']">Contact number is required</div>
                  </div>
                </div>

                <!-- Gender -->
                <div class="col-12 col-md-6">
                  <label for="gender" class="form-label">Gender</label>
                  <select id="gender" formControlName="gender" class="form-select" [ngClass]="{'is-invalid': submitted && f['gender'].errors}">
                    <option value="">Select Gender</option>
                    <option value="MALE">Male</option>
                    <option value="FEMALE">Female</option>
                  </select>
                  <div *ngIf="submitted && f['gender'].errors" class="invalid-feedback">
                    <div *ngIf="f['gender'].errors['required']">Gender is required</div>
                  </div>
                </div>

                <!-- DOB -->
                <div class="col-12 col-md-6">
                  <label for="dob" class="form-label">Date of Birth</label>
                  <input type="date" id="dob" formControlName="dob" class="form-control" [ngClass]="{'is-invalid': submitted && f['dob'].errors}">
                  <div *ngIf="submitted && f['dob'].errors" class="invalid-feedback">
                    <div *ngIf="f['dob'].errors['required']">Date of birth is required</div>
                  </div>
                </div>

                <!-- PIN Code -->
                <div class="col-12 col-md-6">
                  <label for="pinCode" class="form-label">PIN Code</label>
                  <input type="text" id="pinCode" formControlName="pinCode" class="form-control" [ngClass]="{'is-invalid': submitted && f['pinCode'].errors}">
                  <div *ngIf="submitted && f['pinCode'].errors" class="invalid-feedback">
                    <div *ngIf="f['pinCode'].errors['required']">PIN code is required</div>
                  </div>
                </div>

                <!-- Address -->
                <div class="col-12">
                  <label for="address" class="form-label">Address</label>
                  <textarea id="address" formControlName="address" class="form-control" rows="3" [ngClass]="{'is-invalid': submitted && f['address'].errors}"></textarea>
                  <div *ngIf="submitted && f['address'].errors" class="invalid-feedback">
                    <div *ngIf="f['address'].errors['required']">Address is required</div>
                  </div>
                </div>

                <!-- Action Buttons -->
                <div class="col-12 mt-4">
                  <div class="d-flex flex-column flex-sm-row justify-content-end gap-2">
                    <button type="button" class="btn btn-outline-secondary" (click)="goBack()">Cancel</button>
                    <button type="submit" class="btn btn-primary" [disabled]="submitting">
                      <span *ngIf="submitting" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                      Save Changes
                    </button>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
